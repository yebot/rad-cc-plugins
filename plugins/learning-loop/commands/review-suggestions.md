---
description: Review and selectively apply pending improvement suggestions from /reflect sessions. Shows suggestions one by one with options to apply, skip, or modify.
allowed-tools:
  - Bash
  - Read
  - Write
  - Edit
  - AskUserQuestion
---

# Review Suggestions

Review and selectively apply pending improvement suggestions generated by `/reflect`.

## Instructions

### Phase 1: Load Suggestions

1. **Check for pending suggestions:**
   ```bash
   python3 plugins/learning-loop/helpers/learning_helpers.py pending-count
   ```

   If count is 0:
   ```
   No pending suggestions found.
   Run /reflect to capture learnings and generate suggestions.
   ```
   Then stop.

2. **Load all pending suggestions:**
   ```bash
   python3 plugins/learning-loop/helpers/learning_helpers.py list-suggestions
   ```

3. **Sort by priority:**
   - High priority first
   - Then medium
   - Then low
   - Within same priority, sort by creation date (oldest first)

### Phase 2: Present Overview

4. **Show summary:**
   ```markdown
   ## Pending Suggestions

   **Total:** {count}
   - High Priority: {high_count}
   - Medium Priority: {medium_count}
   - Low Priority: {low_count}

   ### Quick Actions
   - Review all: Continue below
   - Apply all high-priority: `/review-suggestions --apply-high`
   - Clear all: `/review-suggestions --clear`
   ```

### Phase 3: Interactive Review

5. **For each suggestion, present:**
   ```markdown
   ---
   ## Suggestion {n} of {total} [{priority} Priority]

   **ID:** {suggestion_id}
   **Target:** {target_path}
   **Section:** {section}
   **Category:** {category}
   **Created:** {timestamp}

   ### Learning
   {learning_content}

   ### Suggested Change
   ```diff
   {diff_preview}
   ```

   ### Options
   - **[A]pply** - Add this to {target_path}
   - **[S]kip** - Keep for later review
   - **[M]odify** - Edit before applying
   - **[D]iscard** - Remove permanently
   - **[Q]uit** - Stop review (keep remaining)

   Choice:
   ```

6. **Handle user choice:**

   **Apply:**
   - Read the target file
   - Find the appropriate section (or create it)
   - Add the suggestion content
   - Write the updated file
   - Mark suggestion as "applied"
   ```bash
   python3 plugins/learning-loop/helpers/learning_helpers.py mark-suggestion {id} applied
   ```

   **Skip:**
   - Leave suggestion as "pending"
   - Continue to next suggestion

   **Modify:**
   - Show the suggestion content
   - Ask user for modifications
   - Apply the modified version
   - Mark as "applied"

   **Discard:**
   - Mark suggestion as "discarded"
   ```bash
   python3 plugins/learning-loop/helpers/learning_helpers.py mark-suggestion {id} discarded
   ```

   **Quit:**
   - Stop the review loop
   - Keep remaining suggestions as pending

### Phase 4: Apply Changes

7. **When applying a suggestion:**

   a. **Read target file:**
   ```bash
   # Check if file exists
   if [ -f "{target_path}" ]; then
     cat "{target_path}"
   fi
   ```

   b. **Find or create section:**
   - Search for the section header (e.g., `## Important Caveats`)
   - If found, add content after existing entries
   - If not found, add new section at appropriate location

   c. **Format the addition based on category:**

   For **caveat**:
   ```markdown
   ### {Short Title}
   - {Caveat content}
   ```

   For **error_fix**:
   ```markdown
   ### {Error Description}
   **Symptoms:** {What happens}
   **Fix:** {Solution}
   ```

   For **command**:
   ```markdown
   ### {What it does}
   ```bash
   {command}
   ```
   ```

   For **dependency**:
   ```markdown
   - **{Package}**: {version/note}
   ```

   For **pattern**:
   ```markdown
   ### {Pattern Name}
   - {Pattern description}
   ```

   d. **Use Edit tool to apply:**
   - Make minimal, focused edits
   - Preserve existing content
   - Add new content in appropriate location

### Phase 5: Summary

8. **After all suggestions reviewed, show summary:**
   ```markdown
   ## Review Complete

   **Applied:** {applied_count}
   **Skipped:** {skipped_count} (kept for later)
   **Discarded:** {discarded_count}

   ### Files Modified
   - {file1} ({change_count} additions)
   - {file2} ({change_count} additions)

   ### Applied Suggestions
   1. ✓ {suggestion_1_summary} → {target}
   2. ✓ {suggestion_2_summary} → {target}
   ...
   ```

9. **Offer to commit changes:**
   ```
   Would you like to commit these changes?

   Suggested commit message:
   ```
   docs: apply learning-loop suggestions

   Applied {count} context improvements:
   - {summary_1}
   - {summary_2}
   ```

   [Y]es / [N]o / [E]dit message:
   ```

10. **Clean up resolved suggestions:**
    ```bash
    python3 plugins/learning-loop/helpers/learning_helpers.py clear-resolved
    ```

## Arguments

| Argument | Description |
|----------|-------------|
| `--priority high` | Only show high-priority suggestions |
| `--priority medium` | Show medium and high priority |
| `--apply-high` | Auto-apply all high-priority without review |
| `--clear` | Discard all pending suggestions |
| `--list` | Just list suggestions, don't review |

## Definition of Done

- [ ] Pending suggestions loaded and sorted
- [ ] Overview presented to user
- [ ] Each suggestion reviewed with user choice
- [ ] Applied suggestions written to target files
- [ ] Suggestion statuses updated (applied/skipped/discarded)
- [ ] Summary of changes presented
- [ ] Commit offered (optional)
- [ ] Resolved suggestions cleared from pending file

## Error Handling

| Issue | Resolution |
|-------|------------|
| Target file doesn't exist | Offer to create it or skip suggestion |
| Section not found | Create new section at end of file |
| Edit conflict | Show current content, ask user to resolve |
| No suggestions | Inform user and suggest /reflect |

## Example Session

```
$ /review-suggestions

## Pending Suggestions

**Total:** 4
- High Priority: 2
- Medium Priority: 1
- Low Priority: 1

---
## Suggestion 1 of 4 [HIGH Priority]

**ID:** sug_20250115143022_a1b2c3
**Target:** CLAUDE.md
**Section:** ## Important Caveats
**Category:** caveat
**Created:** 2025-01-15 14:30

### Learning
OAuth tokens must be refreshed 5 minutes before expiry, not at expiry

### Suggested Change
```diff
## Important Caveats

+ ### OAuth Token Refresh
+ - Refresh tokens 5 minutes before expiry, not at expiry
+ - The provider rejects refresh attempts on already-expired tokens
```

### Options
[A]pply / [S]kip / [M]odify / [D]iscard / [Q]uit

Choice: A

✓ Applied to CLAUDE.md

---
## Suggestion 2 of 4 [HIGH Priority]

**ID:** sug_20250115143025_d4e5f6
**Target:** CLAUDE.md
**Section:** ## Troubleshooting
**Category:** error_fix
...

Choice: M

Enter modified content:
> OAuth token refresh fails silently - check network connectivity first

✓ Applied (modified) to CLAUDE.md

---
## Suggestion 3 of 4 [MEDIUM Priority]
...

Choice: S

⏭ Skipped (kept for later)

---
## Suggestion 4 of 4 [LOW Priority]
...

Choice: D

✗ Discarded

---

## Review Complete

**Applied:** 2
**Skipped:** 1
**Discarded:** 1

### Files Modified
- CLAUDE.md (2 additions)

Would you like to commit these changes? [Y/n]: Y

✓ Changes committed:
  docs: apply learning-loop suggestions

  Applied 2 context improvements:
  - OAuth token refresh timing caveat
  - Token refresh troubleshooting
```
